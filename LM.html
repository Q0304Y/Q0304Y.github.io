<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ•°å­—äººæ–‡å¹³å°</title>
    <!-- ä½¿ç”¨ CDN å¼•å…¥ Cesium -->
    <script src="https://cdn.jsdelivr.net/npm/cesium@1.105/Build/Cesium/Cesium.js"></script>
    <link href="https://cdn.jsdelivr.net/npm/cesium@1.105/Build/Cesium/Widgets/widgets.css" rel="stylesheet">
    <link rel="stylesheet" href="styles.css">
    <style>
        body {
            margin: 0;
            padding: 0;
            overflow: hidden;
            font-family: Arial, sans-serif;
        }
        #cesiumContainer {
            width: 100vw;
            height: 100vh;
            position: relative;
        }
        .control-panel {
            position: absolute;
            top: 20px;
            left: 20px;
            z-index: 1000;
            background: rgba(40, 40, 40, 0.8);
            padding: 15px;
            border-radius: 5px;
            color: white;
        }
        .title {
            position: absolute;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            z-index: 1000;
            background: rgba(40, 40, 40, 0.8);
            padding: 25px;  /* å¢åŠ å†…è¾¹è· */
            border-radius: 5px;
            color: white;
            font-size: 40px;  /* å¢å¤§æ ‡é¢˜å­—å· */
            text-align: center;
            font-weight: bold;  /* åŠ ç²—æ˜¾ç¤º */
            letter-spacing: 2px;  /* å¢åŠ å­—é—´è· */
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.5);  /* æ·»åŠ æ–‡å­—é˜´å½± */
        }
        .info-panel {
            display: none;
            position: fixed;
            background: rgba(40, 40, 40, 0.95);
            color: white;
            padding: 30px;
            border-radius: 10px;
            width: 400px;
            z-index: 1000;
            font-size: 24px;
            box-shadow: 0 6px 16px rgba(0, 0, 0, 0.4);
            line-height: 1.8;
            pointer-events: none;
            /* è¿›ä¸€æ­¥å‘å³ç§»åŠ¨é¢æ¿ä½ç½® */
            right: 420px;  /* ç»§ç»­å¢åŠ å³ä¾§è·ç¦» */
            top: 100px;
        }
        .info-panel h3 {
            font-size: 32px;  /* è¿›ä¸€æ­¥å¢å¤§æ ‡é¢˜å­—å· */
            margin-bottom: 25px;  /* å¢åŠ æ ‡é¢˜ä¸‹æ–¹é—´è· */
            font-weight: bold;
            border-bottom: 3px solid rgba(255, 255, 255, 0.3);  /* åŠ ç²—æ ‡é¢˜ä¸‹åˆ’çº¿ */
            padding-bottom: 15px;  /* å¢åŠ æ ‡é¢˜ä¸‹åˆ’çº¿é—´è· */
        }
        .info-panel p {
            font-size: 24px;  /* è¿›ä¸€æ­¥å¢å¤§æ®µè½å­—å· */
            margin: 18px 0;  /* å¢åŠ æ®µè½é—´è· */
            line-height: 1.8;
        }
        .info-panel p:first-of-type {
            margin-top: 0;
        }
        .info-panel p:last-of-type {
            margin-bottom: 0;
        }
        .timeline-container {
            position: absolute;
            bottom: 30px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(40, 40, 40, 0.9);
            padding: 20px;
            border-radius: 8px;
            color: white;
            z-index: 1000;
            width: 80%;
            text-align: center;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.3);
        }
        
        .timeline-controls {
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 15px;
            gap: 15px; /* æ§ä»¶ä¹‹é—´çš„é—´è· */
        }

        .play-button {
            background: rgba(255, 255, 255, 0.2);
            border: none;
            color: white;
            padding: 12px 24px;
            border-radius: 4px;
            cursor: pointer;
            margin-right: 10px;
            transition: background-color 0.3s;
            font-size: 18px;
        }

        .play-button:hover {
            background: rgba(255, 255, 255, 0.3);
        }
        
        .timeline-slider {
            width: 100%;
            margin: 10px 0;
            height: 4px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 2px;
            outline: none;
        }

        .timeline-slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 16px;
            height: 16px;
            background: #fff;
            border-radius: 50%;
            cursor: pointer;
            transition: transform 0.2s;
        }

        .timeline-slider::-webkit-slider-thumb:hover {
            transform: scale(1.2);
        }
        
        .timeline-date {
            font-size: 24px;
            margin-top: 10px;
            font-weight: bold;
        }

        .timeline-info {
            font-size: 18px;
            margin-top: 8px;
            color: rgba(255, 255, 255, 0.9);
            max-width: 800px;
            margin: 8px auto;
            line-height: 1.4;
        }

        .speed-control {
            display: flex;
            align-items: center;
            gap: 8px;
            color: rgba(255, 255, 255, 0.9);
            font-size: 16px;
        }

        .speed-select {
            background: rgba(255, 255, 255, 0.2);
            border: none;
            color: white;
            padding: 8px;
            border-radius: 4px;
            cursor: pointer;
            outline: none;
            font-size: 16px;
        }

        .speed-select option {
            background: #333;
            color: white;
        }

        .timeline-container {
            pointer-events: auto !important;
            touch-action: none;
            user-select: none;
        }
        
        .timeline-container * {
            pointer-events: auto !important;
        }

        .play-button {
            cursor: pointer !important;
            pointer-events: auto !important;
            background: rgba(255, 255, 255, 0.2);
            border: none;
            color: white;
            padding: 12px 24px;
            border-radius: 4px;
            margin-right: 10px;
            transition: background-color 0.3s;
        }

        .play-button:hover {
            background: rgba(255, 255, 255, 0.3);
        }

        /* ä¿®æ”¹ä¾§æ å’ŒæŒ‰é’®æ ·å¼ */
        .sidebar {
            position: fixed;
            right: -300px;  /* é»˜è®¤éšè—åœ¨å³ä¾§ */
            top: 0;
            width: 300px;
            height: 100%;
            background: rgba(40, 40, 40, 0.9);
            color: white;
            transition: right 0.3s ease;  /* æ·»åŠ è¿‡æ¸¡åŠ¨ç”» */
            overflow-y: auto;
            z-index: 1000;
            padding: 20px;
            opacity: 0;  /* é»˜è®¤å®Œå…¨é€æ˜ */
            visibility: hidden;  /* é»˜è®¤éšè— */
        }

        .sidebar.active {
            right: 0;
            opacity: 1;  /* æ˜¾ç¤ºæ—¶å®Œå…¨ä¸é€æ˜ */
            visibility: visible;  /* æ˜¾ç¤ºæ—¶å¯è§ */
        }

        .sidebar-toggle {
            position: absolute;
            top: 20px;
            right: 20px;
            padding: 10px 20px;
            background: rgba(40, 40, 40, 0.7);
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            z-index: 1001;
            transition: background-color 0.3s;
        }

        .sidebar-toggle:hover {
            background: rgba(60, 60, 60, 0.7);
        }

        /* æ·»åŠ é¼ æ ‡æ‚¬åœæ—¶çš„æ˜¾ç¤ºé€»è¾‘ */
        .sidebar-toggle:hover + .sidebar,
        .sidebar:hover {
            right: 0;
            opacity: 1;
            visibility: visible;
        }

        .location-list {
            list-style: none;
            padding: 0;
            margin: 0;
        }

        .location-item {
            padding: 15px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.2);
            cursor: pointer;
            transition: background-color 0.3s;
            font-size: 18px;
        }

        .location-item:hover {
            background: rgba(255, 255, 255, 0.1);
        }

        .location-item strong {
            font-size: 20px;
            display: block;
            margin-bottom: 5px;
        }

        .location-item em {
            font-size: 16px;
            color: rgba(255, 255, 255, 0.8);
        }
    </style>
</head>
<body>
    <!-- åœ°å›¾å®¹å™¨ -->
    <div id="cesiumContainer"></div>
    <div class="title">é•¿å¾é©å‘½æ–‡ç‰©æ•°å­—åŒ–ä¼ æ‰¿å¹³å°</div>

    <!-- è‡ªå®šä¹‰æ§åˆ¶é¢æ¿ -->
    <div class="control-panel">
        <button onclick="resetView()">é‡ç½®è§†è§’</button>
        <!-- ç§»é™¤äº†å…¨å±åˆ‡æ¢æŒ‰é’® -->
    </div>

    <div id="info-panel" class="info-panel"></div>

    <!-- ä¿®æ”¹æ—¶é—´æ»‘å—å®¹å™¨ç»“æ„ -->
    <div class="timeline-container">
        <div class="timeline-controls">
            <button id="playButton" class="play-button">æ’­æ”¾</button>
            <div class="speed-control">
                <span>æ’­æ”¾é€Ÿåº¦:</span>
                <select id="speedSelect" class="speed-select">
                    <option value="5000">æ…¢é€Ÿ</option>
                    <option value="3000" selected>ä¸­é€Ÿ</option>
                    <option value="1000">å¿«é€Ÿ</option>
                </select>
            </div>
        </div>
        <input type="range" id="timelineSlider" class="timeline-slider" min="0" max="32" value="0">
        <div id="timelineDate" class="timeline-date"></div>
        <div id="timelineInfo" class="timeline-info"></div>
    </div>

    <!-- æ·»åŠ ä¾§æ åˆ‡æ¢æŒ‰é’® -->
    <button class="sidebar-toggle" id="locationSummaryBtn">
        ğŸ“ åœ°ç‚¹æ±‡æ€»
        <div class="sidebar-tooltip">ç‚¹å‡»æŸ¥çœ‹è¯¦ç»†åœ°ç‚¹åˆ—è¡¨</div>
    </button>

    <!-- æ·»åŠ ä¾§æ  -->
    <div class="sidebar">
        <h2>é•¿å¾è·¯çº¿åœ°ç‚¹</h2>
        <ul class="location-list">
            <!-- åœ°ç‚¹åˆ—è¡¨å°†é€šè¿‡ JavaScript åŠ¨æ€ç”Ÿæˆ -->
        </ul>
    </div>

    <script>
        "use strict";  // å¯ç”¨ä¸¥æ ¼æ¨¡å¼

        // è®¾ç½® Cesium Ion Access Token
        Cesium.Ion.defaultAccessToken = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJqdGkiOiJiMzQ5OTY3ZC03YjNjLTQzMDctYTBhZi1kZWI1YmVkMzc2NTUiLCJpZCI6Mjc2NTQ4LCJpYXQiOjE3Mzk3ODk5NTB9.rvU_41gfM6Xiq0gXhgeB8aw9NM7ZYBgvZsRBaFlPEJ0';

        // åˆå§‹åŒ– Viewer
        let viewer;
        Cesium.createWorldTerrainAsync().then(terrainProvider => {
            viewer = new Cesium.Viewer('cesiumContainer', {
                terrainProvider: terrainProvider,
                animation: false,
                timeline: false,
                baseLayerPicker: false,
                fullscreenButton: false,  // ç¦ç”¨é»˜è®¤å…¨å±æŒ‰é’®
                geocoder: false,
                sceneModePicker: false,
                navigationHelpButton: false,
                shadows: false,
                shouldAnimate: true,
                scene3DOnly: true,
                orderIndependentTranslucency: false,
                requestRenderMode: true,  // å¯ç”¨æŒ‰éœ€æ¸²æŸ“
                maximumRenderTimeChange: Infinity,
                contextOptions: {
                    webgl: {
                        alpha: false,
                        antialias: true,
                        preserveDrawingBuffer: true,
                        failIfMajorPerformanceCaveat: false
                    }
                },
                screenSpaceCameraController: {
                    zoomFactor: 0.8,
                    minimumZoomDistance: 500,
                    maximumZoomDistance: 10000000,
                    inertiaZoom: 0.85
                }
            });

            // æ€§èƒ½ä¼˜åŒ–é…ç½®
            viewer.scene.globe.depthTestAgainstTerrain = true;
            viewer.scene.postProcessStages.fxaa.enabled = false;
            viewer.scene.highDynamicRange = false;

            // å®šä¹‰é•¿å¾è·¯çº¿ç‚¹ä½æ•°æ®
            const longMarchData = [
            { id: 1, name: "ç‘é‡‘å¸‚å¶åªä¹¡", province: "æ±Ÿè¥¿", x: 116.03, y: 25.89, remark: "ä¸­å¤®çº¢å†›é•¿å¾å‡ºå‘åœ°", time: "1934/10/10" },
            { id: 2, name: "äºéƒ½å¿è´¡æ±Ÿé•‡", province: "æ±Ÿè¥¿", x: 115.42, y: 25.96, remark: "ä¸­å¤®çº¢å†›ä¸»åŠ›æ¸¡äºéƒ½æ²³", time: "1934/10/17" },
            { id: 3, name: "ä¿¡ä¸°å¿æ–°ç”°é•‡", province: "æ±Ÿè¥¿", x: 114.94, y: 25.37, remark: "çªç ´ç¬¬ä¸€é“å°é”çº¿", time: "1934/10/21" },
            { id: 4, name: "æ±åŸå¿å»¶å¯¿ç‘¶æ—ä¹¡", province: "æ¹–å—", x: 113.68, y: 25.55, remark: "çªç ´ç¬¬äºŒé“å°é”çº¿", time: "1934/11/8" },
            { id: 5, name: "å®œç« å¿ç™½çŸ³æ¸¡é•‡", province: "æ¹–å—", x: 112.94, y: 25.4, remark: "çªç ´ç¬¬ä¸‰é“å°é”çº¿", time: "1934/11/15" },
            { id: 6, name: "å…¨å·å¿å‡¤å‡°é•‡", province: "å¹¿è¥¿", x: 111.07, y: 25.93, remark: "æ¹˜æ±Ÿæˆ˜å½¹ä¸­çº¢ä¸€å†›å›¢é˜»å‡»é˜µåœ°", time: "1934/11/27" },
            { id: 7, name: "å…´å®‰å¿ç•Œé¦–é•‡", province: "å¹¿è¥¿", x: 110.8, y: 25.73, remark: "æ¹˜æ±Ÿæˆ˜å½¹æ ¸å¿ƒæ¸¡å£ï¼ˆçº¢å†›æŸå¤±æƒ¨é‡ï¼‰", time: "1934/12/1" },
            { id: 8, name: "é€šé“å¿å¿æºªé•‡", province: "æ¹–å—", x: 109.78, y: 26.16, remark: "é€šé“ä¼šè®®ï¼ˆè½¬å…µè´µå·ï¼‰", time: "1934/12/12" },
            { id: 9, name: "é»å¹³å¿å¾·å‡¤é•‡", province: "è´µå·", x: 109.14, y: 26.23, remark: "é»å¹³ä¼šè®®ï¼ˆç¡®å®šå‘é»”åŒ—è¿›å†›ï¼‰", time: "1934/12/18" },
            { id: 10, name: "ç“®å®‰å¿çŒ´åœºé•‡", province: "è´µå·", x: 107.47, y: 27.04, remark: "çŒ´åœºä¼šè®®ï¼ˆéµä¹‰ä¼šè®®çš„å‰å¤œï¼‰", time: "1935/1/1" },
            { id: 11, name: "éµä¹‰å¸‚çº¢èŠ±å²—åŒº", province: "è´µå·", x: 106.92, y: 27.7, remark: "éµä¹‰ä¼šè®®", time: "1935/1/15" },
            { id: 12, name: "å…ƒåšé•‡ï¼ˆçŒ¿çŒ´åœºï¼‰", province: "è´µå·", x: 106.04, y: 28.27, remark: "çº¢å†›åˆ†ä¸‰è·¯ä»å…ƒåšé•‡ã€åœŸåŸå—åŒ—åœ°åŒºè¥¿æ¸¡èµ¤æ°´æ²³ï¼Œå‘å››å·çœå¤è”ºã€å™æ°¸åœ°åŒºå‰è¿›ï¼Œä¸€æ¸¡èµ¤æ°´", time: "1935/1/29" },
            { id: 13, name: "åœŸåŸé•‡", province: "è´µå·", x: 105.97, y: 28.32, remark: "çº¢å†›åœ¨åœŸåŸã€é’æ å¡åœ°åŒºå¯¹å°¾è¿½çš„å·å†›å‘èµ·çŒ›æ”»ï¼Œåå†³å®šæ’¤å‡ºæˆ˜æ–—ï¼Œè¥¿æ¸¡èµ¤æ°´æ²³", time: "1935/1/29" },
            { id: 14, name: "å™æ°¸å¿å¤ªå¹³é•‡", province: "å››å·", x: 105.73, y: 28.05, remark: "çº¢å†›å³çºµé˜Ÿè¿›æ”»å™æ°¸ä¸å…‹ï¼Œç»§ç»­è¥¿è¿›ï¼Œåœ¨æ¯›åã€å¤§åç­‰åœ°é­å·å†›æˆªå‡»", time: "1935/2/2" },
            { id: 15, name: "æ‰è¥¿é•‡ï¼ˆä»Šå¨ä¿¡å¿ï¼‰", province: "äº‘å—", x: 105.05, y: 28.03, remark: "çº¢å†›åœ¨æ‰è¥¿åœ°åŒºé›†ç»“å®Œæ¯•ï¼Œå¹¶å¬å¼€æ‰è¥¿ä¼šè®®ï¼ˆ1935å¹´2æœˆ5æ—¥è‡³9æ—¥ï¼‰å†³å®šä¸œæ¸¡èµ¤æ°´æ²³ï¼Œçº¢å†›å›å¸ˆé»”åŒ—", time: "1935/2/9" },
            { id: 16, name: "å¤ªå¹³æ¸¡", province: "è´µå·", x: 106.17, y: 28.12, remark: "çº¢å†›ä»å¤ªå¹³æ¸¡ã€äºŒéƒæ»©æ¸¡è¿‡èµ¤æ°´æ²³ï¼Œå›å¸ˆé»”åŒ—ï¼ŒäºŒæ¸¡èµ¤æ°´", time: "1935/2/18" },
            { id: 17, name: "æ¡æ¢“å¿å¨„å±±å…³", province: "è´µå·", x: 106.82, y: 27.68, remark: "çº¢å†›è¿›æ”»å¨„å±±å…³åŠå…¶ä»¥å—åœ°åŒºçš„é»”å†›ï¼Œæ”»å å¨„å±±å…³", time: "1935/2/25" },
            { id: 18, name: "éµä¹‰å¸‚", province: "è´µå·", x: 106.9, y: 27.57, remark: "çº¢å†›å†å éµä¹‰åŸï¼Œå¹¶æ§åˆ¶åŸè¥¿å—çš„è€é¸¦å±±ã€çº¢èŠ±å²—ä¸€çº¿é«˜åœ°", time: "1935/2/28" },
            { id: 19, name: "èŒ…å°é•‡", province: "è´µå·", x: 106.31, y: 27.72, remark: "çº¢å†›åœ¨èŒ…å°åŠå…¶é™„è¿‘è¥¿æ¸¡èµ¤æ°´æ²³ï¼Œè¿›å…¥å·å—ï¼Œä¸‰æ¸¡èµ¤æ°´", time: "1935/3/16" },
            { id: 20, name: "å¤è”ºå¿äºŒéƒé•‡", province: "å››å·", x: 106.03, y: 28.23, remark: "çº¢å†›è¿›å…¥å¤è”ºå¿ï¼Œæ‘†å‡ºåŒ—æ¸¡é•¿æ±Ÿçš„æ€åŠ¿ï¼Œè’‹ä»‹çŸ³å†æ¬¡å°†ä¸»åŠ›é›†ä¸­åˆ°å·å—", time: "1935/3/19" },
            { id: 21, name: "äºŒéƒæ»©", province: "è´µå·", x: 106.17, y: 28.12, remark: "çº¢å†›ä»äºŒéƒæ»©ã€å¤ªå¹³æ¸¡ã€ä¹æºªå£ç¬¬å››æ¬¡æ¸¡è¿‡èµ¤æ°´æ²³", time: "1935/3/22" },
            { id: 22, name: "ä»æ€€å¿å–œå¤´é•‡", province: "è´µå·", x: 106.44, y: 27.77, remark: "çº¢å†›ç»ä»æ€€å¿å¤šåœ°è¡Œè¿›ï¼Œç»§ç»­å—ç§»ï¼Œæ‘†è„±æ•Œå†›è¿½å‡»", time: "1935/3/23" },
            { id: 23, name: "ç¦„åŠå¿çšå¹³æ¸¡é•‡", province: "äº‘å—", x: 102.42, y: 26.12, remark: "å·§æ¸¡é‡‘æ²™æ±Ÿï¼ˆçº¢å†›æ€»å‚è°‹é•¿åˆ˜ä¼¯æ‰¿ç‡é¢†å…ˆé£é˜ŸæŠ¢å çšå¹³æ¸¡å£ï¼Œç¼´è·æœ¨èˆ¹å¹¶æˆåŠŸæ¸¡è¿‡é‡‘æ²™æ±Ÿï¼‰", time: "1935/5/9" },
            { id: 24, name: "çŸ³æ£‰å¿å®‰é¡ºåœºé•‡", province: "å››å·", x: 102.36, y: 29.23, remark: "å¼ºæ¸¡å¤§æ¸¡æ²³ï¼ˆçº¢å†›å…ˆå¤´éƒ¨é˜Ÿåœ¨å®‰é¡ºåœºå¼ºæ¸¡å¤§æ¸¡æ²³ï¼ŒæˆåŠŸå é¢†åŒ—å²¸æ¸¡å£ï¼‰", time: "1935/5/25" },
            { id: 25, name: "æ³¸å®šå¿æ³¸æ¡¥é•‡", province: "å››å·", x: 102.23, y: 29.91, remark: "é£å¤ºæ³¸å®šæ¡¥ï¼ˆçº¢å†›çº¢å››å›¢çªå‡»é˜Ÿåœ¨å¤©ä¸‹å¤§é›¨çš„æƒ…å†µä¸‹ï¼Œä¸€æ˜¼å¤œå¥”è¢­240é‡Œï¼ŒæˆåŠŸå¤ºå–æ³¸å®šæ¡¥ï¼‰", time: "1935/5/29" },
            { id: 26, name: "å®å…´å¿ç¡—ç¢›è—æ—ä¹¡", province: "å››å·", x: 102.82, y: 30.69, remark: "ç¿»è¶Šå¤¹é‡‘å±±ï¼ˆçº¢å†›ä»å®å…´å¿ç¡—ç¢›æ‘å‡ºå‘ï¼Œå†ç»7å¤©7å¤œç¿»è¶Šå¤¹é‡‘å±±ï¼Œä¸çº¢å››æ–¹é¢å†›åœ¨æ‡‹åŠŸä¼šå¸ˆï¼‰", time: "1935/6/12" },
            { id: 27, name: "å°é‡‘å¿è¾¾ç»´é•‡", province: "å››å·", x: 102.36, y: 31.01, remark: "çº¢ä¸€ã€çº¢å››æ–¹é¢å†›åœ¨æ‡‹åŠŸï¼ˆä»Šå°é‡‘ï¼‰ä¼šå¸ˆ", time: "1935/6/18" },
            { id: 28, name: "è‹¥å°”ç›–å¿ç­ä½‘ä¹¡", province: "å››å·", x: 102.96, y: 33.58, remark: "çº¢å†›å³è·¯å†›ä»æ¯›å„¿ç›–å‡ºå‘ï¼Œç»è¿‡7å¤©è‰°è‹¦è¡Œå†›ï¼Œåˆ°è¾¾è‰åœ°å°½å¤´çš„ç­ä½‘åœ°åŒº", time: "1935/8/27" },
            { id: 29, name: "è¿­éƒ¨å¿æ—ºè—ä¹¡", province: "ç”˜è‚ƒ", x: 103.23, y: 34.06, remark: "æ”»å…‹è…Šå­å£å‰æŒ‡æŒ¥éƒ¨é©»åœ°", time: "1935/9/17" },
            { id: 30, name: "é€šæ¸­å¿æ¦œç½—é•‡", province: "ç”˜è‚ƒ", x: 105.25, y: 35.2, remark: "æ¦œç½—é•‡ä¼šè®®ï¼ˆç¡®å®šé™•åŒ—ä¸ºç»ˆç‚¹ï¼‰", time: "1935/9/27" },
            { id: 31, name: "å´èµ·é•‡", province: "é™•è¥¿", x: 108.4, y: 36.92, remark: "ä¸­å¤®çº¢å†›åˆ°è¾¾é™•ç”˜æ ¹æ®åœ°çš„å´èµ·é•‡ï¼Œä¸é™•åŒ—çº¢å†›èƒœåˆ©ä¼šå¸ˆ", time: "1935/10/19" },
            { id: 32, name: "ä¼šå®å¿", province: "ç”˜è‚ƒ", x: 105.04, y: 35.68, remark: "çº¢ä¸€æ–¹é¢å†›ä¸çº¢å››æ–¹é¢å†›åœ¨ä¼šå®å¿åŸèƒœåˆ©ä¼šå¸ˆ", time: "1936/10/9" },
            { id: 33, name: "è¥¿å‰å¿å°†å°å ¡", province: "å®å¤å›æ—è‡ªæ²»åŒº", x: 105.98, y: 35.85, remark: "çº¢ä¸€æ–¹é¢å†›ä¸çº¢äºŒæ–¹é¢å†›åœ¨å°†å°å ¡èƒœåˆ©ä¼šå¸ˆï¼Œæ ‡å¿—ç€çº¢å†›ä¸‰å¤§ä¸»åŠ›é•¿å¾èƒœåˆ©ç»“æŸ", time: "1936/10/22" }
        ];

            // ä¿®æ”¹ç›¸æœºåˆå§‹åŒ–é…ç½®
            const initialView = {
                destination: Cesium.Cartesian3.fromDegrees(
                    105.0,   // ç»åº¦ï¼ˆè°ƒæ•´åˆ°é•¿å¾è·¯çº¿ä¸­å¿ƒä½ç½®ï¼‰
                    32.0,    // çº¬åº¦ï¼ˆè°ƒæ•´åˆ°æ›´é åŒ—çš„ä½ç½®ä»¥æ˜¾ç¤ºå®Œæ•´è·¯çº¿ï¼‰
                    8000000  // é«˜åº¦ï¼ˆå¢åŠ é«˜åº¦ä»¥è·å¾—æ›´å¹¿çš„ä¿¯è§†è§†è§’ï¼‰
                ),
                orientation: {
                    heading: Cesium.Math.toRadians(0),   // åŒ—å‘
                    pitch: Cesium.Math.toRadians(-90),   // å®Œå…¨ä¿¯è§†
                    roll: 0
                }
            };

            // è®¾ç½®ç›¸æœºçº¦æŸ
            viewer.scene.screenSpaceCameraController.minimumZoomDistance = 100;
            viewer.scene.screenSpaceCameraController.maximumZoomDistance = 20000000;

            // åˆå§‹åŒ–è§†è§’
            viewer.camera.setView(initialView);

            // ä¿®æ”¹é‡ç½®è§†è§’åŠŸèƒ½
            window.resetView = function () {
                viewer.camera.flyTo({
                    ...initialView,
                    duration: 2,  // é£è¡Œæ—¶é—´ï¼ˆç§’ï¼‰
                    easingFunction: Cesium.EasingFunction.QUINTIC_IN_OUT
                });
            };

            // ç¡®ä¿æ‰€æœ‰ç‚¹ä½åœ¨åˆå§‹åŒ–æ—¶å°±æ˜¾ç¤º
            function showAllPoints() {
                viewer.entities.values.forEach(entity => {
                    if (entity.id.startsWith('point-')) {
                        entity.show = true;
                    }
                });
                
                const positions = longMarchData.map(point => 
                    Cesium.Cartesian3.fromDegrees(point.x, point.y, 5000)
                );
                
                const routeEntity = viewer.entities.getById('long-march-route');
                if (routeEntity) {
                    routeEntity.polyline.positions = new Cesium.CallbackProperty(() => {
                        return positions;
                    }, false);
                }
            }

            // åœ¨åˆå§‹åŒ–æ—¶ç«‹å³æ˜¾ç¤ºæ‰€æœ‰ç‚¹ä½
            showAllPoints();

            // çª—å£å°ºå¯¸å˜åŒ–å¤„ç†
            window.addEventListener('resize', () => {
                viewer.resize();
            });

            // æ›¿ä»£æ–¹æ¡ˆï¼šä½¿ç”¨å¤šæ®µçº¿ç»˜åˆ¶
            const positions = [];
            for (let i = 0; i < longMarchData.length - 1; i++) {
                // åœ¨ä¸¤ç‚¹ä¹‹é—´æ’å…¥å¤šä¸ªç‚¹ä»¥å½¢æˆå¹³æ»‘çš„æ›²çº¿
                const startPoint = longMarchData[i];
                const endPoint = longMarchData[i + 1];
                
                // åœ¨ä¸¤ç‚¹ä¹‹é—´æ’å…¥10ä¸ªç‚¹
                for (let j = 0; j <= 10; j++) {
                    const fraction = j / 10;
                    const lat = startPoint.y + (endPoint.y - startPoint.y) * fraction;
                    const lon = startPoint.x + (endPoint.x - startPoint.x) * fraction;
                    positions.push(Cesium.Cartesian3.fromDegrees(lon, lat, 5000));
                }
            }

            viewer.entities.add({
                id: 'long-march-route', // ä¸ºè·¯çº¿æ·»åŠ è‡ªå®šä¹‰ID
                polyline: {
                    positions: positions,
                    width: 3,
                    material: new Cesium.PolylineDashMaterialProperty({
                        color: Cesium.Color.RED.withAlpha(0.9),
                        dashLength: 16.0
                    }),
                    clampToGround: false,
                    classificationType: Cesium.ClassificationType.BOTH,
                    zIndex: 100,
                    show: true
                }
            });

            // ä¿®æ”¹æ·»åŠ ç‚¹ä½çš„éƒ¨åˆ†
            longMarchData.forEach(point => {
                viewer.entities.add({
                    id: `point-${point.id}`, // ä½¿ç”¨è‡ªå®šä¹‰ID
                    position: Cesium.Cartesian3.fromDegrees(point.x, point.y, 5000),
                    point: {
                        pixelSize: 10,
                        color: Cesium.Color.WHITE,
                        outlineColor: Cesium.Color.BLACK,
                        outlineWidth: 2,
                        disableDepthTestDistance: Number.POSITIVE_INFINITY
                    },
                    properties: {
                        name: point.name,
                        province: point.province,
                        x: point.x,
                        y: point.y,
                        remark: point.remark,
                        time: point.time
                    },
                    show: true
                });
            });

            // ä¿®æ”¹ç‚¹å‡»äº‹ä»¶å¤„ç†
            const infoPanel = document.getElementById('info-panel');
            const handler = new Cesium.ScreenSpaceEventHandler(viewer.scene.canvas);
            
            handler.setInputAction(function(click) {
                const pickedObject = viewer.scene.pick(click.position);
                
                if (Cesium.defined(pickedObject) && 
                    pickedObject.id && 
                    pickedObject.id.properties && 
                    pickedObject.id.id.startsWith('point-')) { // åªå¤„ç†ç‚¹ä½å®ä½“
                    
                    const properties = pickedObject.id.properties;
                    
                    showInfoPanel(Cesium.Cartesian3.fromDegrees(properties.x.getValue(), properties.y.getValue(), 5000), `
                        <h3>${properties.name.getValue()}</h3>
                        <p>çœä»½ï¼š${properties.province.getValue()}</p>
                        <p>ç»åº¦ï¼š${properties.x.getValue()}</p>
                        <p>çº¬åº¦ï¼š${properties.y.getValue()}</p>
                        <p>å¤‡æ³¨ï¼š${properties.remark.getValue()}</p>
                        <p>æ—¶é—´ï¼š${properties.time.getValue()}</p>
                    `);
                } else {
                    infoPanel.style.display = 'none';
                }
            }, Cesium.ScreenSpaceEventType.LEFT_CLICK);

            // æ·»åŠ ç‚¹å‡»å…¶ä»–åœ°æ–¹å…³é—­ä¿¡æ¯é¢æ¿çš„å¤„ç†
            document.addEventListener('click', function(event) {
                if (!event.target.closest('#info-panel') && 
                    !event.target.closest('#cesiumContainer')) {
                    infoPanel.style.display = 'none';
                }
            });

            // ä¿®æ”¹æ—¶é—´å¤„ç†å‡½æ•°
            function setupTimeline() {
                const slider = document.getElementById('timelineSlider');
                const dateDisplay = document.getElementById('timelineDate');
                const infoDisplay = document.getElementById('timelineInfo');
                const playButton = document.getElementById('playButton');
                const speedSelect = document.getElementById('speedSelect');
                const timelineContainer = document.querySelector('.timeline-container');
                let isPlaying = false;
                let animationFrameId = null;
                let lastTime = 0;
                
                const STEPS_BETWEEN_POINTS = 50;
                const totalSteps = (longMarchData.length - 1) * STEPS_BETWEEN_POINTS;

                // æ·»åŠ æ—¥æœŸæ’å€¼å‡½æ•°
                function interpolateDates(startDate, endDate, fraction) {
                    const start = new Date(startDate.replace('/', '-').replace('/', '-'));
                    const end = new Date(endDate.replace('/', '-').replace('/', '-'));
                    const timestamp = start.getTime() + (end.getTime() - start.getTime()) * fraction;
                    const date = new Date(timestamp);
                    return `${date.getFullYear()}/${(date.getMonth() + 1).toString().padStart(2, '0')}/${date.getDate().toString().padStart(2, '0')}`;
                }

                // ä¿®æ”¹æ›´æ–°æ­¥éª¤å‡½æ•°ï¼Œä¼˜åŒ–è·¯çº¿æ›´æ–°é€»è¾‘
                function updateToStep(step) {
                    const pointIndex = Math.floor(step / STEPS_BETWEEN_POINTS);
                    const fraction = (step % STEPS_BETWEEN_POINTS) / STEPS_BETWEEN_POINTS;
                    
                    const currentPoint = longMarchData[pointIndex];
                    const nextPoint = longMarchData[Math.min(pointIndex + 1, longMarchData.length - 1)];
                    
                    // æ›´æ–°æ—¥æœŸå’Œä¿¡æ¯æ˜¾ç¤º
                    const currentDate = interpolateDates(currentPoint.time, nextPoint.time, fraction);
                    dateDisplay.textContent = currentDate;
                    infoDisplay.textContent = `${currentPoint.name} - ${currentPoint.remark}`;

                    // æ›´æ–°ç‚¹ä½æ˜¾ç¤º
                    viewer.entities.values.forEach(entity => {
                        if (entity.id.startsWith('point-')) {
                            const pointId = parseInt(entity.id.split('-')[1]);
                            entity.show = pointId <= pointIndex + 1;
                            
                            // é«˜äº®å½“å‰ç‚¹
                            if (pointId === currentPoint.id) {
                                entity.point.pixelSize = 15;
                                entity.point.color = Cesium.Color.YELLOW;
                                
                                // æ˜¾ç¤ºå½“å‰ç‚¹çš„ä¿¡æ¯é¢æ¿
                                const infoPanel = document.getElementById('info-panel');
                                infoPanel.innerHTML = `
                                    <h3>${currentPoint.name}</h3>
                                    <p>çœä»½ï¼š${currentPoint.province}</p>
                                    <p>ç»åº¦ï¼š${currentPoint.x}</p>
                                    <p>çº¬åº¦ï¼š${currentPoint.y}</p>
                                    <p>å¤‡æ³¨ï¼š${currentPoint.remark}</p>
                                    <p>æ—¶é—´ï¼š${currentPoint.time}</p>
                                `;
                                infoPanel.style.display = 'block';
                            } else {
                                // æ¢å¤å…¶ä»–ç‚¹çš„é»˜è®¤æ ·å¼
                                entity.point.pixelSize = 10;
                                entity.point.color = Cesium.Color.WHITE;
                            }
                        }
                    });

                    // ä¼˜åŒ–è·¯çº¿æ›´æ–°é€»è¾‘
                    const positions = [];
                    
                    // æ·»åŠ å·²ç»è¿‡çš„æ‰€æœ‰ç‚¹
                    for (let i = 0; i <= pointIndex; i++) {
                        positions.push(Cesium.Cartesian3.fromDegrees(
                            longMarchData[i].x,
                            longMarchData[i].y,
                            5000
                        ));
                    }
                    
                    // åªåœ¨éœ€è¦æ—¶æ·»åŠ æ’å€¼ç‚¹
                    if (pointIndex < longMarchData.length - 1 && fraction > 0) {
                        const interpolatedX = currentPoint.x + (nextPoint.x - currentPoint.x) * fraction;
                        const interpolatedY = currentPoint.y + (nextPoint.y - currentPoint.y) * fraction;
                        positions.push(Cesium.Cartesian3.fromDegrees(interpolatedX, interpolatedY, 5000));
                    }

                    // ä¸€æ¬¡æ€§æ›´æ–°è·¯çº¿
                    const routeEntity = viewer.entities.getById('long-march-route');
                    if (routeEntity) {
                        routeEntity.polyline.positions = new Cesium.CallbackProperty(() => {
                            return positions;
                        }, false);
                    }
                }

                // ä¿®æ”¹åˆå§‹åŒ–è·¯çº¿çš„æ–¹å¼
                function showAllPoints() {
                    viewer.entities.values.forEach(entity => {
                        if (entity.id.startsWith('point-')) {
                            entity.show = true;
                        }
                    });
                    
                    const positions = longMarchData.map(point => 
                        Cesium.Cartesian3.fromDegrees(point.x, point.y, 5000)
                    );
                    
                    const routeEntity = viewer.entities.getById('long-march-route');
                    if (routeEntity) {
                        routeEntity.polyline.positions = new Cesium.CallbackProperty(() => {
                            return positions;
                        }, false);
                    }
                }

                // ä¿®æ”¹åªæ˜¾ç¤ºèµ·ç‚¹çš„å‡½æ•°
                function showOnlyStart() {
                    viewer.entities.values.forEach(entity => {
                        if (entity.id.startsWith('point-')) {
                            const pointId = parseInt(entity.id.split('-')[1]);
                            entity.show = pointId === 1;
                        }
                    });
                    
                    const routeEntity = viewer.entities.getById('long-march-route');
                    if (routeEntity) {
                        const startPoint = longMarchData[0];
                        routeEntity.polyline.positions = new Cesium.CallbackProperty(() => {
                            return [Cesium.Cartesian3.fromDegrees(startPoint.x, startPoint.y, 5000)];
                        }, false);
                    }
                }

                // ä¼˜åŒ–åŠ¨ç”»å‡½æ•°
                function animate(currentTime) {
                    if (!isPlaying) {
                        cancelAnimationFrame(animationFrameId);
                        animationFrameId = null;
                        return;
                    }

                    if (!lastTime) lastTime = currentTime;
                    const deltaTime = currentTime - lastTime;
                    const speed = parseInt(speedSelect.value);

                    if (deltaTime >= speed / STEPS_BETWEEN_POINTS) {
                        const currentValue = parseInt(slider.value);
                        if (currentValue < totalSteps) {
                            slider.value = currentValue + 1;
                            updateToStep(currentValue + 1);
                            lastTime = currentTime;
                        } else {
                            stopPlay();
                            return;
                        }
                    }

                    animationFrameId = requestAnimationFrame(animate);
                }

                function startPlay() {
                    if (isPlaying || animationFrameId) return; // é˜²æ­¢é‡å¤å¯åŠ¨
                    
                    isPlaying = true;
                    playButton.textContent = 'æš‚åœ';
                    lastTime = 0;
                    
                    // åªåœ¨å®Œæ•´æ’­æ”¾ç»“æŸåé‡ç½®
                    if (parseInt(slider.value) >= totalSteps) {
                        slider.value = 0;
                        showOnlyStart();
                    }
                    
                    animationFrameId = requestAnimationFrame(animate);
                }

                function stopPlay() {
                    if (!isPlaying && !animationFrameId) return;
                    
                    isPlaying = false;
                    if (animationFrameId) {
                        cancelAnimationFrame(animationFrameId);
                        animationFrameId = null;
                    }
                    lastTime = 0;
                    playButton.textContent = 'æ’­æ”¾';
                    
                    // éšè—ä¿¡æ¯é¢æ¿
                    const infoPanel = document.getElementById('info-panel');
                    infoPanel.style.display = 'none';
                    
                    // æ¢å¤æ‰€æœ‰ç‚¹çš„é»˜è®¤æ ·å¼
                    viewer.entities.values.forEach(entity => {
                        if (entity.id.startsWith('point-')) {
                            entity.point.pixelSize = 10;
                            entity.point.color = Cesium.Color.WHITE;
                        }
                    });
                    
                    showAllPoints();
                }

                // ä¼˜åŒ–äº‹ä»¶ç›‘å¬
                playButton.addEventListener('click', (e) => {
                    e.stopPropagation();
                    e.preventDefault();
                    
                    // æ·»åŠ é˜²æŠ–
                    if (playButton.getAttribute('data-clicking')) return;
                    playButton.setAttribute('data-clicking', 'true');
                    
                    if (isPlaying) {
                        stopPlay();
                    } else {
                        startPlay();
                    }
                    
                    // 200msåç§»é™¤é˜²æŠ–æ ‡è®°
                    setTimeout(() => {
                        playButton.removeAttribute('data-clicking');
                    }, 200);
                });

                // ä¼˜åŒ–æ»‘å—äº‹ä»¶
                slider.addEventListener('input', (e) => {
                    e.stopPropagation();
                    const value = parseInt(e.target.value);
                    updateToStep(value);
                });

                // ä¼˜åŒ–é€Ÿåº¦æ§åˆ¶
                speedSelect.addEventListener('change', (e) => {
                    e.stopPropagation();
                    if (isPlaying) {
                        lastTime = 0; // é‡ç½®æ—¶é—´ä»¥é€‚åº”æ–°é€Ÿåº¦
                    }
                });

                // ç¡®ä¿æ—¶é—´è½´æ§ä»¶ä¸å½±å“åœ°å›¾æ“ä½œ
                timelineContainer.addEventListener('mousedown', (e) => e.stopPropagation(), true);
                timelineContainer.addEventListener('mousemove', (e) => e.stopPropagation(), true);
                timelineContainer.addEventListener('mouseup', (e) => e.stopPropagation(), true);
                timelineContainer.addEventListener('wheel', (e) => {
                    e.stopPropagation(); // ä»…é˜»æ­¢å†’æ³¡
                });
                timelineContainer.addEventListener('touchstart', (e) => e.stopPropagation(), true);
                timelineContainer.addEventListener('touchmove', (e) => e.stopPropagation(), true);
                timelineContainer.addEventListener('touchend', (e) => e.stopPropagation(), true);

                // ç¡®ä¿åœ°å›¾æ§åˆ¶å§‹ç»ˆå¯ç”¨
                viewer.scene.screenSpaceCameraController.enableRotate = true;
                viewer.scene.screenSpaceCameraController.enableTranslate = true;
                viewer.scene.screenSpaceCameraController.enableZoom = true;
                viewer.scene.screenSpaceCameraController.enableTilt = true;
                viewer.scene.screenSpaceCameraController.enableLook = true;

                // åˆå§‹åŒ–æ˜¾ç¤º
                slider.min = 0;
                slider.max = totalSteps;
                slider.value = 0;
                showAllPoints();
            }
            
            // åœ¨åœ°å›¾åŠ è½½å®Œæˆååˆå§‹åŒ–æ—¶é—´è½´
            viewer.scene.globe.tileLoadProgressEvent.addEventListener(() => {
                if (viewer.scene.globe.tilesLoaded) {
                    setupTimeline();
                }
            });

            // ä¿®æ”¹ setupSidebar å‡½æ•°
            function setupSidebar() {
                const sidebar = document.querySelector('.sidebar');
                const sidebarToggle = document.querySelector('.sidebar-toggle');
                const locationList = document.querySelector('.location-list');

                // ç§»é™¤åŸæœ‰çš„é¼ æ ‡äº‹ä»¶ç›‘å¬å™¨
                sidebarToggle.removeEventListener('mouseenter', () => {});
                sidebarToggle.removeEventListener('mouseleave', () => {});
                document.removeEventListener('mousemove', () => {});

                // ä¿®æ”¹ç”Ÿæˆåœ°ç‚¹åˆ—è¡¨çš„ä»£ç 
                function updateLocationList() {
                    const locationList = document.querySelector('.location-list');
                    
                    // æ¸…ç©ºç°æœ‰åˆ—è¡¨
                    while (locationList.firstChild) {
                        locationList.removeChild(locationList.firstChild);
                    }

                    // ä½¿ç”¨Setè¿‡æ»¤é‡å¤é¡¹
                    const uniqueNames = new Set();
                    longMarchData.forEach(point => {
                        if (!uniqueNames.has(point.name)) {
                            uniqueNames.add(point.name);
                            
                            const li = document.createElement('li');
                            li.className = 'location-item';
                            li.innerHTML = `
                                <strong>${point.name}</strong><br>
                                <em>${point.time}</em>
                            `;
                            
                            // æ·»åŠ ç‚¹å‡»äº‹ä»¶
                            li.addEventListener('click', () => {
                                // è®¡ç®—åˆå§‹ç›¸æœºä½ç½®
                                const heading = Cesium.Math.toRadians(0);
                                const pitch = Cesium.Math.toRadians(-45);
                                const initialRange = 50000;
                                
                                // è®¾ç½®ç›®æ ‡ç‚¹ä½ç½®
                                const targetPosition = Cesium.Cartesian3.fromDegrees(
                                    point.x,
                                    point.y,
                                    0
                                );
                                
                                viewer.camera.flyTo({
                                    destination: Cesium.Cartesian3.add(
                                        targetPosition,
                                        Cesium.Cartesian3.multiplyByScalar(
                                            viewer.camera.direction,
                                            -initialRange,
                                            new Cesium.Cartesian3()
                                        ),
                                        new Cesium.Cartesian3()
                                    ),
                                    orientation: {
                                        heading: heading,
                                        pitch: pitch,
                                        roll: 0
                                    },
                                    duration: 2,
                                    complete: function() {
                                        const controller = viewer.scene.screenSpaceCameraController;
                                        controller.minimumZoomDistance = 500;
                                        controller.maximumZoomDistance = 10000000;
                                        controller.zoomFactor = 1.2;
                                        controller.inertiaZoom = 0.95;
                                        viewer.camera.lookAtTransform(Cesium.Matrix4.IDENTITY);
                                        viewer.camera._setTransform(Cesium.Matrix4.IDENTITY);
                                        
                                        // é«˜äº®æ˜¾ç¤ºé€»è¾‘
                                        viewer.entities.values.forEach(entity => {
                                            if (entity.id.startsWith('point-')) {
                                                const pointId = parseInt(entity.id.split('-')[1]);
                                                entity.point.pixelSize = pointId === point.id ? 15 : 10;
                                                entity.point.color = pointId === point.id ? Cesium.Color.YELLOW : Cesium.Color.WHITE;
                                            }
                                        });
                                    }
                                });

                                // æ˜¾ç¤ºç‚¹ä½ä¿¡æ¯é¢æ¿
                                const infoPanel = document.getElementById('info-panel');
                                infoPanel.innerHTML = `
                                    <h3>${point.name}</h3>
                                    <p>çœä»½ï¼š${point.province}</p>
                                    <p>ç»åº¦ï¼š${point.x}</p>
                                    <p>çº¬åº¦ï¼š${point.y}</p>
                                    <p>å¤‡æ³¨ï¼š${point.remark}</p>
                                    <p>æ—¶é—´ï¼š${point.time}</p>
                                `;
                                infoPanel.style.display = 'block';
                            });
                            
                            locationList.appendChild(li);
                        }
                    });
                }

                // åœ¨æ•°æ®åŠ è½½å®Œæˆåè°ƒç”¨
                updateLocationList();

                // é˜²æ­¢ä¾§æ æ“ä½œå½±å“åœ°å›¾
                sidebar.addEventListener('mousedown', (e) => e.stopPropagation());
                sidebar.addEventListener('mousemove', (e) => e.stopPropagation());
                sidebar.addEventListener('mouseup', (e) => e.stopPropagation());
                sidebar.addEventListener('wheel', (e) => e.stopPropagation());
                sidebar.addEventListener('touchstart', (e) => e.stopPropagation());
                sidebar.addEventListener('touchmove', (e) => e.stopPropagation());
                sidebar.addEventListener('touchend', (e) => e.stopPropagation());
            }

            // åœ¨åœ°å›¾åŠ è½½å®Œæˆååˆå§‹åŒ–ä¾§æ å’Œæ—¶é—´è½´
            viewer.scene.globe.tileLoadProgressEvent.addEventListener(() => {
                if (viewer.scene.globe.tilesLoaded) {
                    setupSidebar();
                    setupTimeline();
                }
            });

            // é…ç½®æŒ‰éœ€æ¸²æŸ“æ¨¡å¼
            viewer.scene.requestRenderMode = true;
            viewer.scene.preRender.addEventListener(() => {
                viewer.scene.requestRender();
            });

            // åœ¨åˆå§‹åŒ–åæ·»åŠ è¿™äº›æ€§èƒ½ä¼˜åŒ–
            viewer.scene.globe.maxScreenSpaceError = 2; // é™ä½åœ°å½¢ç²¾åº¦ï¼ˆé»˜è®¤1.0ï¼‰
            viewer.scene.globe.preloadAncestors = false;
            viewer.scene.globe.dynamicAtmosphereLighting = false;
            viewer.scene.fog.enabled = false;
            viewer.scene.skyAtmosphere.show = false;

            // éçº¿æ€§ç¼©æ”¾æ›²çº¿å‡½æ•°
            function exponentialZoom(delta) {
                const sign = Math.sign(delta);
                const absDelta = Math.min(Math.abs(delta), 1);
                return sign * Math.pow(absDelta, 2);
            }

            // é‡å†™æ»šè½®äº‹ä»¶å¤„ç†
            viewer.scene.screenSpaceCameraController.zoom = function(delta) {
                const adjustedDelta = exponentialZoom(delta);
                Cesium.ScreenSpaceCameraController.prototype.zoom.call(this, adjustedDelta);
            };

            // æ·»åŠ æ™ºèƒ½è¾¹ç¼˜æ£€æµ‹
            let hideTimeout;
            const sidebar = document.querySelector('.sidebar');
            const triggerBtn = document.getElementById('locationSummaryBtn');

            // ç²¾ç¡®æ§åˆ¶æ˜¾ç¤ºé€»è¾‘
            triggerBtn.addEventListener('mouseenter', () => {
                clearTimeout(hideTimeout);
                sidebar.style.right = '0';
            });

            [triggerBtn, sidebar].forEach(element => {
                element.addEventListener('mouseleave', (e) => {
                    if (!e.relatedTarget || 
                        !(e.relatedTarget === triggerBtn || 
                          e.relatedTarget === sidebar || 
                          e.relatedTarget.closest('.sidebar'))) {
                        hideTimeout = setTimeout(() => {
                            sidebar.style.right = '-300px';
                        }, 300); // 300mså»¶è¿Ÿé˜²æ­¢è¯¯è§¦
                    }
                });
            });

            // ä¿®æ”¹ showInfoPanel å‡½æ•°
            function showInfoPanel(position, content) {
                const infoPanel = document.getElementById('info-panel');
                
                // å›ºå®šé¢æ¿åœ¨é¡µé¢å³ä¸Šè§’
                const panelWidth = 300;
                const panelHeight = 200;
                const rightOffset = 100; // ç¡®ä¿ä¸ä¸ä¾§è¾¹æ é‡åˆ
                const topOffset = 100;   // å‘ä¸‹ç§»åŠ¨çš„åç§»é‡

                // åº”ç”¨å®šä½
                infoPanel.style.cssText = `
                    right: ${rightOffset}px;
                    top: ${topOffset}px;
                    display: block;
                    position: fixed;  // ä½¿ç”¨å›ºå®šå®šä½
                `;
                infoPanel.className = 'info-panel';
                infoPanel.innerHTML = content;
            }
        }).catch(error => {
            console.error('åœ°å½¢åŠ è½½å¤±è´¥:', error);
            alert('åœ°å½¢åŠ è½½å¤±è´¥ï¼Œè¯·æ£€æŸ¥ç½‘ç»œè¿æ¥æˆ– Access Token');
        });
    </script>
</body>
</html>